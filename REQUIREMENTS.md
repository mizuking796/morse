# モールス信号変換アプリ — 要件定義書

## 概要
自然言語とモールス信号を双方向に変換するスマホ向けWebアプリ。
音・光・テキストの3系統で出力し、逆変換はタップ・マイク・テキストの3系統で入力できる。

## 対応言語
| モールス体系 | 文字セット | 備考 |
|---|---|---|
| 国際モールス | A-Z, 0-9, 主要記号（. , ? ! / @ など） | ITU-R M.1677 準拠 |
| 和文モールス | ア-ン, 濁音, 半濁音, 長音, 句読点 | JIS X 0201 カナ対応 |

- 入力テキストに応じて自動判定（英数→国際、カナ/ひらがな→和文）
- 混在テキストも対応（英語部分は国際、日本語部分は和文で変換）

## 画面構成

### メイン画面（2タブ切替）

#### タブ1: テキスト → モールス（エンコード）
- テキスト入力エリア（複数行対応）
- 「変換」ボタン
- 出力エリア: モールスコード表示（・ー / .- 表記切替可能）
- 再生コントロール:
  - 音再生ボタン（Web Audio API によるビープ音）
  - 光再生ボタン（画面フラッシュ）
  - 速度調整スライダー（WPM: 5〜30）
- 再生中のリアルタイムハイライト（現在再生中の文字をハイライト）

#### タブ2: モールス → テキスト（デコード）
- **3つの入力モード（切替式）:**

  **A. タップ入力モード**
  - 画面下部に大きなタップボタン
  - 短押し → 短点（・）、長押し → 長点（ー）
  - 一定時間無操作 → 文字区切り / さらに長い無操作 → 単語区切り
  - 入力中のモールスコードをリアルタイム表示
  - バイブレーション/音フィードバック

  **B. マイク入力モード**
  - マイクから音声を取得（MediaStream API）
  - 音のON/OFF長さを解析してモールスに変換
  - 閾値（感度）調整スライダー
  - 入力波形のリアルタイム表示（簡易）

  **C. テキスト入力モード**
  - .- や ・ー 形式でモールスコードを直接入力
  - スペース = 文字区切り、/ = 単語区切り

- デコード結果表示エリア

### サブ機能
- **モールスコード一覧表**（リファレンス）
  - 国際モールス / 和文モールス 切替タブ
  - 各文字のコードと音の試聴ボタン
- **設定**
  - 音の周波数（Hz）: 400〜1000、デフォルト700Hz
  - WPM（速度）: 5〜30、デフォルト15
  - 表記形式: .- / ・ー 切替
  - ダークモード切替

## 技術仕様

### モールスタイミング（ITU準拠）
- 短点（dit）: 1単位
- 長点（dah）: 3単位
- 信号間（同一文字内）: 1単位
- 文字間: 3単位
- 単語間: 7単位
- 1単位の長さ = 1200ms / WPM

### 音声出力
- Web Audio API（OscillatorNode + GainNode）
- 正弦波（sine wave）
- アタック/リリースの短いエンベロープ（クリックノイズ防止）

### 光出力
- 画面全体を白くフラッシュ（document.body.style.backgroundColor）
- フラッシュ中は全UI非表示でフル画面

### マイク入力
- MediaStream API + AudioContext + AnalyserNode
- 音量の閾値超過でON/OFF判定
- ON時間の長さで短点/長点を判別
- 無音時間の長さで文字区切り/単語区切りを判別

### タップ入力
- touchstart / touchend イベントでタイミング計測
- Vibration API でフィードバック（対応端末のみ）

## 非機能要件
- **スマホファースト**: 320px〜428px幅を最優先、PC表示も崩れないレスポンシブ
- **オフライン動作**: 単一HTMLファイルで外部依存なし
- **PWA不要**: 単一HTMLなのでインストール機能は不要
- **パフォーマンス**: 変換は即時、音/光再生はリアルタイム
- **ブラウザ対応**: Safari(iOS), Chrome(Android) — Web Audio API, MediaStream API 対応

## デプロイ
- GitHub Pages（`mizuking796/morse`）
- `https://mizuking796.github.io/morse/`

## ファイル構成
```
/Users/mizukishirai/claude/services/morse/
├── index.html          ← 単一HTMLアプリ（本体）
├── REQUIREMENTS.md     ← 本ファイル（要件定義）
└── REFERENCE.md        ← 技術リファレンス（実装後に作成）
```

## バージョン計画
- **v1.0**: テキスト⇔モールス双方向変換（テキスト入出力 + 音再生）
- **v1.1**: 光出力 + タップ入力
- **v1.2**: マイク入力 + 波形表示
- **v1.3**: 和文モールス対応
- **v1.4**: コード一覧表 + 設定画面 + ダークモード
